{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="profile_header d-flex align-items-center">
    <h2>Welcome, {{ current_user.username }}!</h2>
    <img src="{{ current_user.profile_picture }}" alt="Profile Picture" class="rounded-circle" width = "50" height = "50">
</div>

<div class="card-deck">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Profile</h5>
            <p class="card-text">Manage your profile information.</p>
            <a href="{{ url_for('user_routes.profile') }}" class="btn btn-primary">Edit Profile</a>
        </div>
    </div>
</div>
<h2>Your Feed</h2>
{% for media in media_items %}
    <div class="media-post">
        <img src="{{ media.item.coverart }}" alt="{{ media.item.title }}" width="100">
        <h3>{{ media.item.title }}</h3>
        <p>Added by: {{ media.user.username }}</p>
        {% if media.entry.date_consumed %}
            <p>Consumed on: {{ media.entry.date_consumed.strftime('%Y-%m-%d') }}</p>
        {% endif %}
        {% if media.entry.review %}
            <p>Review: {{ media.entry.review }}</p>
        {% endif %}
        {% if media.entry.rating %}
            <p>Rating: {{ media.entry.rating }}/5</p>
        {% endif %}
        <p>Likes: {{ media.likes }}</p>
        <form action="{{ url_for('user_routes.like', user_media_id=media.entry.user_media_id) }}" method="POST">
            <button type="submit">{{ "Unlike" if media.liked_by_me else "Like" }}</button>
        </form>
        <h4>Comments</h4>
        {% for comment in media.comments %}
            <p>{{ comment.user.username }}: {{ comment.content }} ({{ comment.created_at.strftime('%Y-%m-%d %H:%M') }})</p>
        {% endfor %}
        <form action="{{ url_for('user_routes.comment', user_media_id=media.entry.user_media_id) }}" method="POST">
            <textarea name="content" placeholder="Add a comment"></textarea>
            <button type="submit">Comment</button>
        </form>
    </div>
    <hr>
{% endfor %}

<h2>Search Users</h2>
<form method="POST" action="{{ url_for('user_routes.search_users') }}">
    <input type="text" name="query" placeholder="Search by username">
    <button type="submit">Search</button>
</form>
{% if users %}
    <h3>Search Results:</h3>
    {% for user in users %}
        <div>
            <p>{{ user.username }}</p>
            <form action="{{ url_for('user_routes.follow', user_id=user.user_id) }}" method="POST">
                <button type="submit">Follow</button>
            </form>
            <form action="{{ url_for('user_routes.unfollow', user_id=user.user_id) }}" method="POST">
                <button type="submit">Unfollow</button>
            </form>
        </div>
    {% endfor %}
{% endif %}
<a href="{{ url_for('media_routes.notifications') }}">View Notifications</a>
{% endblock %}